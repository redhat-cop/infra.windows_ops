---
# =============================================================================
# Windows Server 2025 DISA STIG V1R0-1 - Manual Controls Documentation
# =============================================================================
#
# This file documents STIG controls that cannot be fully automated through
# Ansible and require manual verification, organizational policy, or
# administrative procedures.
#
# =============================================================================

- name: STIG Manual Controls | INFO | Display manual control information
  ansible.builtin.debug:
    msg:
      - "============================================================================="
      - "WINDOWS SERVER 2025 DISA STIG V1R0-1 MANUAL CONTROLS"
      - "============================================================================="
      - "Total Controls Documented: 35"
      - "Categories:"
      - "- Active Directory & Domain Controllers"
      - "- Procedural & Organizational Policy"
      - "- Certificate & PKI Management"
      - "- Firmware & Hardware (UEFI/Secure Boot)"
      - "- Auditing & Monitoring Infrastructure"
      - "============================================================================="
  tags:
    - manual_controls
    - info

# =============================================================================
# MANUAL CONTROLS VERIFICATION
# =============================================================================

- name: STIG Manual Controls | AUDIT | Record manual control requirements
  ansible.builtin.set_fact:
    windows_manage_stig_results: "{{ windows_manage_stig_results | default([]) + [windows_manage_stig_manual_result] }}"
  vars:
    windows_manage_stig_manual_result:
      stig_id: "{{ item.stig_id }}"
      title: "{{ item.title }}"
      rule_section: "Manual Controls"
      severity: "{{ item.severity | default('CAT II') }}"
      scored: false
      status: "MANUAL"
      current_value: "Requires manual verification"
      expected_value: "Verified by administrator"
      manual_remediation: true
      remediation_notes: "Refer to Windows Server 2025 STIG documentation for specific verification steps."
      check_mode: "{{ ansible_check_mode }}"
  loop:
    - { stig_id: 'V-278148', title: 'AD Group Policy Objects must have proper audit settings' }
    - { stig_id: 'V-278149', title: 'AD Domain object must have proper audit settings' }
    - { stig_id: 'V-278150', title: 'AD Infrastructure object must have proper audit settings' }
    - { stig_id: 'V-278151', title: 'AD Domain Controllers OU must have proper audit settings' }
    - { stig_id: 'V-278152', title: 'AD AdminSDHolder object must have proper audit settings' }
    - { stig_id: 'V-278153', title: 'AD RID Manager$ object must have proper audit settings' }
    - { stig_id: 'V-278159', title: 'Domain controllers must have a PKI server certificate' }
    - { stig_id: 'V-278160', severity: 'CAT I', title: 'DC PKI certificates must be issued by DOD PKI or approved ECA' }
    - { stig_id: 'V-278162', title: 'AD user accounts must require CAC/PIV/ALT for authentication' }
    - { stig_id: 'V-278163', title: 'Domain controllers must require LDAP access signing' }
    - { stig_id: 'V-277987', severity: 'CAT I', title: 'Administrative accounts must not access internet applications' }
    - { stig_id: 'V-278177', severity: 'CAT I', title: 'Only authorized administrators can have admin rights' }
    - { stig_id: 'V-277989', title: 'Application account passwords must be >= 15 characters' }
    - { stig_id: 'V-278176', title: 'krbtgt account password must be reset every 180 days' }
    - { stig_id: 'V-278195', title: 'Built-in Guest account must be disabled' }
    - { stig_id: 'V-278197', title: 'Built-in Administrator account must be renamed' }
    - { stig_id: 'V-278198', title: 'Built-in Guest account must be renamed' }
    - { stig_id: 'V-277982', title: 'Must install security updates per authoritative source' }
    - { stig_id: 'V-277984', title: 'Must synchronize system clocks with approved source' }
    - { stig_id: 'V-278027', title: 'FTP servers must prevent anonymous logons' }
    - { stig_id: 'V-278031', title: 'Systems must have UEFI firmware and run in UEFI mode' }
    - { stig_id: 'V-278032', title: 'Systems must have Secure Boot enabled' }
    - { stig_id: 'V-278161', title: 'User accounts must be required to have a valid PKI certificate' }
    - { stig_id: 'V-278192', title: 'DOD Root CA certificates must be in Trusted Root Store' }
    - { stig_id: 'V-278193', title: 'DOD Interoperability Root CA cross-certificates must be in Untrusted Store' }
    - { stig_id: 'V-278194', title: 'US DOD CCEB Interoperability Root CA cross-certificates must be in Untrusted Store' }
    - { stig_id: 'V-278138', title: 'Active Directory data files must have proper permissions' }
    - { stig_id: 'V-278072', title: 'Machine account lockout threshold must be configured' }
    - { stig_id: 'V-278087', title: 'Force logoff when logon hours expire must be configured' }
    - { stig_id: 'V-278041', title: 'Audit records must be backed up to a different system' }
    - { stig_id: 'V-278042', title: 'Audit records must be backed up at least every seven days' }
    - { stig_id: 'V-278043', title: 'Audit log storage capacity must be allocated' }
    - { stig_id: 'V-278044', title: 'Audit records must provide info for monitoring/investigation' }
    - { stig_id: 'V-278045', title: 'Audit system must be configured to audit account management' }
    - { stig_id: 'V-278046', title: 'Audit configuration must be protected from unauthorized changes' }
    - { stig_id: 'V-278178', title: 'Local administrator accounts must have their privileged token filtered' }
    - { stig_id: 'V-278225', title: 'LAN Manager authentication level must be configured to send NTLMv2 response only' }
  tags:
    - manual_controls
    - compliance

# =============================================================================
# SUMMARY
# =============================================================================

- name: STIG Manual Controls | INFO | Summary statistics
  ansible.builtin.set_fact:
    windows_manage_stig_control_summary:
      total_stig_controls: 281
      automated_controls: 248
      manual_controls: 33
      coverage_percentage: 100.0
  tags:
    - manual_controls
    - stats
